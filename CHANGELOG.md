# Changelog

## [Unreleased] - 2025-06-22

### Added
- **Система логирования с уровнями**
  - Новый пакет `logger` с поддержкой 4 уровней: DEBUG, INFO, WARN, ERROR
  - Параметр командной строки `-log-level` для выбора уровня логирования
  - По умолчанию используется уровень INFO
  - Глобальные функции логирования для удобства использования

- **Debug логирование во всех модулях**
  - **API Gateway**: детальное логирование HTTP запросов, заголовков, парсинга
  - **Authentication**: подробности процесса аутентификации, подписей, ключей
  - **Request Parser**: детали парсинга путей, операций, параметров
  - **Response Writer**: информация о формировании ответов
  - **Handlers**: логирование обработки запросов в Mock и Policy Routing handlers

- **Улучшенная отладка**
  - Логирование всех HTTP заголовков на уровне DEBUG
  - Детали внутренних структур данных (S3Request, S3Response)
  - Подробности процесса аутентификации AWS SigV4
  - Информация о маппинге ошибок в S3 коды

### Fixed
- **Критические исправления аутентификации** (по результатам code review)
  - **Исправлена проблема с телом запроса**: теперь `req.Body` не потребляется при валидации подписи
  - **Исправлена фильтрация заголовков**: AWS SDK получает все заголовки для корректного вычисления подписи
  - **Упрощена функция calculateExpectedSignature**: убрано избыточное клонирование, строже требования к x-amz-date
  - **Удалена избыточная проверка времени**: проверка времени жизни запроса делегирована AWS SDK

### Changed
- Заменены все `log.Printf` на новую систему логирования
- Обновлена документация с примерами использования разных уровней логирования
- Добавлены примеры отладки в README.md
- Обновлены тесты для соответствия новым требованиям аутентификации

### Technical Details
- **Новые файлы**:
  - `logger/logger.go` - основная реализация системы логирования
  - `logger/logger_test.go` - тесты для системы логирования
  - `example_usage.md` - подробные примеры использования
  - `auth/AUTH_REVIEW_FIXES.md` - документация исправлений по ревью
  - `CHANGELOG.md` - этот файл

- **Модифицированные файлы**:
  - `main.go` - добавлен параметр `-log-level` и инициализация логгера
  - `apigw/gateway.go` - заменено логирование, добавлены debug логи
  - `apigw/parser.go` - добавлены debug логи парсинга
  - `apigw/response_writer.go` - добавлены debug логи записи ответов
  - `auth/static_authenticator.go` - **критические исправления** + подробное логирование аутентификации
  - `auth/static_authenticator_test.go` - обновлены тесты
  - `handlers/mock.go` - добавлены debug логи
  - `handlers/s3handler.go` - добавлены debug логи и улучшено info логирование
  - `handlers/s3handler_test.go` - исправлен тест для новых требований аутентификации
  - `README.md` - обновлена документация

### Benefits
1. **Упрощенная отладка**: Больше не нужно включать/выключать debug код
2. **Гибкость**: Можно менять уровень логирования без перекомпиляции
3. **Производительность**: В продакшне можно использовать минимальное логирование
4. **Стандартизация**: Единообразное логирование во всех модулях
5. **Удобство разработки**: Подробная информация для понимания работы системы
6. **Корректность аутентификации**: Исправлены критические проблемы с обработкой запросов

### Usage Examples
```bash
# Отладка с максимальной детализацией
./s3proxy -log-level debug -mock

# Стандартная работа (по умолчанию)
./s3proxy -log-level info

# Продакшн с минимальным логированием
./s3proxy -log-level error
```
